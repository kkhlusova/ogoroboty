# Система видеонаблюдения и управления роботом Омегабот

## Описание

Система состоит из двух частей:
1. **Серверная часть** (на Raspberry Pi 3):
   - Захватывает видео с USB-камеры
   - Передает видеопоток на ноутбук по UDP
   - Принимает команды управления с ноутбука и передает их Arduino через I2C
   - Управляет моторами робота

2. **Клиентская часть** (на ноутбуке):
   - Принимает видеопоток с Raspberry Pi
   - Отображает видео в графическом интерфейсе
   - Предоставляет элементы управления для движения робота
   - Отправляет команды управления на Raspberry Pi

## Архитектура

- **Видео**: GStreamer используется для захвата и передачи видео через UDP
- **Управление**: Qt GUI для интерфейса пользователя, TCP/UDP для передачи команд
- **Протокол**: Простой бинарный протокол для передачи команд управления
- **Связь с Arduino**: I2C интерфейс

## Структура проекта

```
robot_video_system/
├── server_video/           # Серверная часть (на Raspberry Pi)
│   ├── video_stream_server.cpp    # Трансляция видео
│   ├── robot_command_server.h     # Прием команд управления
│   ├── main.cpp                  # Главный файл сервера
│   └── CMakeLists.txt
├── client/                 # Клиентская часть (на ноутбуке)
│   ├── robot_control_client.cpp   # GUI и прием видео
│   ├── network_handler.h          # Отправка команд
│   ├── network_handler.cpp
│   └── CMakeLists.txt
└── build.sh               # Скрипт сборки
```

## Зависимости

### На Raspberry Pi:
- GStreamer 1.0+
- Qt 5
- CMake
- Библиотеки V4L2 для работы с камерой

### На ноутбуке:
- GStreamer 1.0+
- Qt 5
- CMake

## Сборка

Выполните скрипт сборки:

```bash
./build.sh
```

Или соберите вручную:

### Сервер (Raspberry Pi):
```bash
cd server_video/build
cmake ..
make -j$(nproc)
```

### Клиент (ноутбук):
```bash
cd client/build
cmake ..
make -j$(nproc)
```

## Запуск

### На Raspberry Pi (сервер):
```bash
cd server_video/build
./video_stream_server [IP_НОУТБУКА] [ПОРТ_ВИДЕО] [ПОРТ_КОМАНД] [ID_КАМЕРЫ] [АДРЕС_ARDUINO]
```

Пример:
```bash
./video_stream_server 192.168.1.100 5000 8888 0 8
```

### На ноутбуке (клиент):
```bash
cd client/build
./robot_control_client
```

## Управление роботом

После запуска клиента:

1. Введите IP-адрес Raspberry Pi и порт (по умолчанию 192.168.1.101:8888)
2. Нажмите "Connect to Robot"
3. Нажмите "Start Video" для получения видеопотока
4. Используйте кнопки управления:
   - ↑ - Вперед
   - ↓ - Назад
   - ← - Влево
   - → - Вправо
   - ● - Стоп

## Протокол команд

Формат команды: [ID_команды][параметр1][параметр2]

- 0: Вперед (параметр1: скорость)
- 1: Назад (параметр1: скорость)
- 2: Влево (параметр1: скорость)
- 3: Вправо (параметр1: скорость)
- 4: Стоп
- 5: Установить скорости моторов (параметр1: левый, параметр2: правый)
- 6: Запрос статуса

## Возможные проблемы и решения

1. **Нет изображения с камеры**: Проверьте подключение камеры и права доступа к `/dev/video*`
2. **Нет связи с Arduino**: Проверьте подключение по I2C и адрес устройства
3. **Проблемы с сетью**: Убедитесь, что Raspberry Pi и ноутбук находятся в одной сети

## Настройка для вашей системы

1. Измените IP-адреса в коде под вашу сеть
2. При необходимости измените номера портов
3. Укажите правильный ID камеры (обычно 0 для первой камеры)
4. Укажите правильный адрес Arduino